<!doctype html>
<!-- https://github.com/paulirish/html5-boilerplate/blob/master/index.html -->
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="">

  <!-- encoding must be specified within the first 512 bytes
        www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html#charset -->

  <!-- meta element for compatibility mode needs to be before
        all elements except title & meta
        msdn.microsoft.com/en-us/library/cc288325(VS.85).aspx -->
  <!-- Chrome Frame is only invoked if meta element for
        compatibility mode is within the first 1K bytes
        code.google.com/p/chromium/issues/detail?id=23003 -->

  <title>Bin 2D uneven data</title>
  <meta name="description" content="Binning irregularly spaced data on independent rectangular cells.
">
  <meta name="author" content="Fernando Paolo">

  <!--  Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="">

    <!-- Place favicon.ico & apple-touch-icon.png
        in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    <link rel="stylesheet" href="/media/css/site.css">
  <link rel="stylesheet" href="/media/css/syntax.css">
  
    <!-- All JavaScript at the bottom, except for Modernizr which
        enables HTML5 elements & feature detects -->
   <script src="/media/js/libs/modernizr-1.7.min.js"></script>
    </head>
<body id="bin-data">
        <div id="bar"></div>
                <div id="main" role="main">

          <header class="clearfix">
          </header>

          <div id="sidebar">
          <div id="logo">
          <a href=index.html><img src="/media/images/logo3.png" /></a>
          </div>
          <h4>About this site</h4>
          <p>Welcome to my website! This is the place where I keep stuff
          related to my work (or anything that I may find useful) online.</p>
          <h4>Navigation</h4>
                              <nav class=nav>
    <ul>
                <li>
            <a title="Research projects"
                class="research"
                href="/research">
                Research</a>
        </li>        <li>
            <a title="Source code and utilities"
                class="code"
                href="/https://github.com/fspaolo/code">
                Code</a>
        </li>        <li>
            <a title="Diverse material"
                class="material"
                href="/material">
                Material</a>
        </li>        <li>
            <a title="To reflect about certain things"
                class="readings"
                href="/readings">
                Readings</a>
        </li>        <li>
            <a title="About me and this site"
                class="about"
                href="/about">
                About</a>
        </li>    </ul>
</nav>
                              <h4>Most recent</h4>
          <p>SLP variability in the Amundsen Sea, to submit <a href="#">more &raquo;</a></p>
          <p>Poster presented at IGS/FRIS Meeting in San Diego. <a href="#">more &raquo;</a></p>
          <!--
          <p>SLP variability in the Amundsen Sea, GRL. <a href="#">more &raquo;</a></p>
          -->
          </div>

          <section class="content">
          <article>

<small>
<time datetime="2010-11-06">
    Posted on 06 Nov 2010
</time>
</small>

<h1 class="title">
    <a href="/code/bin-data.html">
        Bin 2D uneven data
    </a>
</h1>

<h6 class="description">
    <a href="/code/bin-data.html">
        Binning irregularly spaced data on independent rectangular cells.

    </a>
</h6>

<p>Here is a very simple method to compute median (or mean) values on rectangular bins using <strong>only</strong> the data withing the particular bin in question, and performing no estimation if no data is&nbsp;available.</p>
<h2 id="source-code">Source&nbsp;code</h2>
<ul>
<li><code>bindata.py</code> - Simple module for binning irregularly spaced data 
  on independent rectangular cells (regular&nbsp;grid).</li>
</ul>
<p>Get the code on <a href="https://github.com/fspaolo/code/tree/master/bindata">GitHub</a>.</p>
<h2 id="example">Example</h2>
<p>Function for binning data using rectangular&nbsp;cells:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">bindata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ppbin</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">binval</span><span class="o">=</span><span class="s">&#39;median&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin irregularly spaced data on a regular grid (center of the bins).</span>

<span class="sd">    Computes the median (default) or mean value within bins defined by</span>
<span class="sd">    regularly spaced xi and yi coordinates (the grid defining the bins).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : ndarray (1D)</span>
<span class="sd">        The idependent variables x- and y-axis of the grid.</span>
<span class="sd">    z : ndarray (1D)</span>
<span class="sd">        The dependent variable in the form z = f(x,y).</span>
<span class="sd">    xi, yi : ndarray (1D)</span>
<span class="sd">        The coordinates defining the x- and y-axis of the grid.</span>
<span class="sd">    ppbin : boolean, optional</span>
<span class="sd">        The function returns `bins` variable (see below for description): </span>
<span class="sd">        [False | True].</span>
<span class="sd">    binval : string, optional</span>
<span class="sd">        The statistical operator used to compute the value of each </span>
<span class="sd">        bin: [&#39;median&#39; | &#39;mean&#39;].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    grid : ndarray (2D)</span>
<span class="sd">        The evenly binned data. The value of each cell is the median</span>
<span class="sd">        (or mean) value of the contents of the bin.</span>
<span class="sd">    bins : ndarray (2D)</span>
<span class="sd">        A grid the same shape as `grid`, except the value of each cell</span>
<span class="sd">        is the number of points per bin. Returns only if `ppbin` is set</span>
<span class="sd">        to True.</span>

<span class="sd">    Revisions</span>
<span class="sd">    ---------</span>
<span class="sd">    2010-11-06 Fernando Paolo, Initial version </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">binval</span> <span class="o">==</span> <span class="s">&#39;median&#39;</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># make the grid</span>
    <span class="n">nrow</span> <span class="o">=</span> <span class="n">yi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ncol</span> <span class="o">=</span> <span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">xi</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ppbin</span><span class="p">:</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="c"># step size (rectangular cells)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">hx</span> <span class="o">=</span> <span class="n">dx</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">hy</span> <span class="o">=</span> <span class="n">dy</span><span class="o">/</span><span class="mf">2.</span>

    <span class="c"># bin the data</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="n">xc</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>          <span class="c"># xc,yc = center of the bin</span>
            <span class="n">yc</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">ind</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xc</span><span class="o">-</span><span class="n">hx</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xc</span><span class="o">+</span><span class="n">hx</span><span class="p">)</span> <span class="o">&amp;</span> \
                            <span class="p">(</span><span class="n">yc</span><span class="o">-</span><span class="n">hy</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">yc</span><span class="o">+</span><span class="n">hy</span><span class="p">))</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">npts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">median</span><span class="p">:</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ppbin</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">npts</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">ppbin</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># return the grid</span>
    <span class="k">if</span> <span class="n">ppbin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">grid</span><span class="p">,</span> <span class="n">bins</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">grid</span>
</pre></div>


<p>Using the above function we can compare the binning process against other interpolation method, e.g., <a href="http://en.wikipedia.org/wiki/Natural_neighbor">natural neighbor</a>. So place the file <code>bindata.py</code> in the same directory as the following&nbsp;script:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">matplotlib.mlab</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">bindata</span> <span class="kn">import</span> <span class="n">bindata</span><span class="p">,</span> <span class="n">plotbins</span>  <span class="c"># the bindata.py module</span>

<span class="c"># make up some randomly distributed data</span>
<span class="n">npts</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># define the grid</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c"># grid the data.</span>
<span class="n">zi</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

<span class="c"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plotbins</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xi</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Gridded data (</span><span class="si">%d</span><span class="s"> points)&#39;</span> <span class="o">%</span> <span class="n">npts</span><span class="p">)</span>

<span class="c"># bin the data.</span>
<span class="n">zi</span> <span class="o">=</span> <span class="n">bindata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

<span class="c"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plotbins</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xi</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Binned data (</span><span class="si">%d</span><span class="s"> points)&#39;</span> <span class="o">%</span> <span class="n">npts</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>And we get the following images. Note the empty cells where no data (black dots) are&nbsp;available:</p>
<p><img alt="Binned data" src="/media/images/binned-data.png" />
<img alt="Gridded data" src="/media/images/gridded-data.png" /></p>
</article>          <footer>
          this website is proudly powered by <a href="http://www.python.org/">Python</a>,
          build with the static site generator <a href="http://hyde.github.com/">Hyde</a>, 
          pages and source code hosted on <a href="https://github.com/fspaolo/">GitHub</a>,
          and all the text written using <a href="http://www.vim.org/">VIM
          </footer>
          </section>

          </div>
        
    <!-- Javascript at the bottom for fast page loading -->
    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.5.1.min.js">\x3C/script>')</script>
  
    
  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script>DD_belatedPNG.fix('img, .png_bg'); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb </script>
  <![endif]-->

      
  </body>
</html>