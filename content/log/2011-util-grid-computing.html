---
title: Grid computing with Apple's Xgrid
description: Setting up a grid of computers with the Apple's 
             Xgrid software (Desktop version).
created: !!timestamp '2011-12-26 10:20:00'
---

The Xgrid agent
---------------

Configure the agent using the Sharing panel in System Preferences.

The Xgrid controller
--------------------

Straightforward on Mac OS X **Server**. On the Desktop version use the **XgridLite** open source software to:

* Turn on and off the built-in Xgrid controller with a single click
* Set passwords for client and agent authentication
* Reset the controller to default settings

The Xgrid Daemon Control Interface
----------------------------------

Command line: 

    :::bash
    $ xgridctl

Start the controller:

    :::bash
    $ ssh username@remote.controller.edu
    $ sudo xgridctl c start

Turn off an agent:

    :::bash
    $ ssh username@remote.agent.edu
    $ sudo xgridctl a stop

More options:

    :::bash
    $ sudo xgridctl
    usage: xgridctl [controller|agent] status|start|stop|restart

The Xgrid Admin tool
--------------------

Provides a summary of the activity of the grid. Download a piece of Mac OS X Server for free from [Apple's website](http://support.apple.com/downloads/).

A hack for Snow Leopard...
--------------------------

To have read/write permission on the agents in ``/Volumes`` we need kerberos. But it is only available on Mac OS X **Server**... instead, one can simply change the configuration files:

    :::bash
    $ sudo cp /usr/share/sandbox/xgridagentd_task_nobody.sb  \
              /usr/share/sandbox/xgridagentd_task_nobody.sb.bak

    $ sudo cp /usr/share/sandbox/xgridagentd_task_somebody.sb  \ 
              /usr/share/sandbox/xgridagentd_task_nobody.sb 

The xgrid command-line client
-----------------------------

Set the environmental variables:

    :::bash
    $ export XGRID_CONTROLLER_HOSTNAME=hostname
    $ export XGRID_CONTROLLER_PASSWORD=password

Client submits jobs to the controller:

    :::bash
    $ xgrid -job submit /usr/bin/python -O test1.txt 

    {jobIdentifier = 231; }

Client queries the results:

    :::bash
    $ xgrid -job results -id 231 

Agent jobs 
----------

What is copied to the agents?

* The **Command** (if relative path): `/tmp/xgagent.GSI0Z6o4/bin/sh`
* The **Working dir** (if relative path): `/tmp/xgagent.bUDiNL4g`

Client results
--------------

What is copied back to the client?

* The **stdout** stream
* The **stderr** stream
* The **working dir**

Submitting multiple jobs
------------------------

Single task jobs. Simply let the controller managing the jobs:

    :::bash
    $ xgrid -job submit /usr/bin/python test1.py
    $ xgrid -job submit /usr/bin/python test2.py
    $ xgrid -job submit /usr/bin/python test3.py
    ...

Running batch jobs
------------------

Multiple task jobs. Use the following scripts to create and send batch files to the controller, and to retrive the results:

* [xg-batch.py](https://github.com/fspaolo/code/tree/master/xgrid)
* [xg-result.py](https://github.com/fspaolo/code/tree/master/xgrid)

To generate and submit a batch file with jobs that call a program `prog` with command line argument `arg` on several files:

    :::bash
    $ python xg-batch.py -s -j jobname -c "/path/to/prog -a arg" /path/to/files/*.ext

Retrieving results by passing ID files (generated by `xg-batch.py`):

    :::bash
    $ python xg-result.py file1.id file2.id file3.id ... 

Or by passing a dir containing those files:

    :::bash
    $ python xg-result.py /path/to/dir

More info
---------

* Xgrid: [http://www.apple.com/science/hardware/gridcomputing.html](http://www.apple.com/science/hardware/gridcomputing.html)
* Tutorials: [http://macresearch.org/the_xgrid_tutorials](http://macresearch.org/the_xgrid_tutorials)
