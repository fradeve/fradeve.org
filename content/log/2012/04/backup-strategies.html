---
title: "Backup strategies"
created: !!timestamp '2012-04-14 15:15:00'
charset: utf-8
featured: yes
tags:
    - backup
---

_Ultimo aggiornamento: 23 febbraio 2013_

Non ho molto tempo per spiegare l'immagine. In soldoni, è uno schema riassuntivo di come sono organizzati i miei dati ed i miei backup, realizzato anche per approfondire un po' la conoscenza di Graphviz. Il codice è in fondo al post.

<center>![][1]<br>_Storie di ordinario backup_</center>

_Legenda_

* in verde le cartelle cifrate
* in rosso le parti dell'infrastruttura ancora da creare
* sono state usate forme e frecce differenti per distinguere i processi

Il codice dell'immagine:

    digraph G {
        // TODO
        // * legend
        // * bold cluster labels
        graph [ dpi = 300 ];
        size ="4,6";	// table size
        compound=true;
        ranksep="1.5"
        rankdir="LR"

        subgraph cluster_edgar {
            style=filled;
            color=lightgrey;
            label = "edgar";

            // boxes
            subgraph cluster_drop {
                style=filled;
                color=white;
                label = "Dropbox";

                irssi [label="~/.irssi",shape=folder]
                rsnapshot [label="backup\ndir",shape=folder]
            }
            
            // scripts and programs
            offlineimap [label="offlineimap",shape=component]
            script_rsnapshot [label="rsnapshot",shape=component]
            rsync [label="rsync",shape=component]
            firefox [label="Firefox",shape=component]
            
            // folders
            mail [label="~/.mail",shape=folder,style=filled,fillcolor="#008000"]
            filesystem_edgar [label="filesystem",shape=folder]
        }

        subgraph cluster_mail {
            style=filled;
            color=lightblue;
            label = "Mail services";

            ai [label="A/I \nmail",shape=box3d,style=filled,fillcolor="#808000"]
            gmail [label="Gmail",shape=box3d]
            riseup [label="Riseup \nmail",shape=box3d,style=filled,fillcolor="#808000"]
        }

        subgraph cluster_services {
            style=filled;
            color=lightblue;
            label = "Internet services";

            github [label="GitHub",shape=component]
            ffsync [label="Firefox\nSync",shape=component]
            librefm [label="Libre.fm",shape=component]
            facebook [label="Facebook",shape=component]
            twitter [label="Twitter",shape=component]
            foursquare [label="Foursquare",shape=component]
            gcalendar [label="GCalendar",shape=component]
            gcontacts [label="GContacts",shape=component]
        }

        subgraph cluster_hosting{
            style=filled;
            color=lightblue;
            label = "Hosting services";

            subgraph cluster_droponline{
                style=filled;
                color=blue;
                label = "Dropbox";

                irssidrop [label="~/.irssi",shape=folder,style=filled,fillcolor=green]
                rsnapshot_edgar_drop [label="backup\nedgar\novh\nparanoia",shape=folder,style=filled,fillcolor=green]
            }
        }

        subgraph cluster_ext_storage {
            style=filled;
            color=lightgrey;
            label = "External \nstorage";

            // hds
            subgraph cluster_hd1 {
                style=filled;
                color=white;
                label = "320 Gb";

                immagini_hd1 [label="immagini",shape=folder]
                musica_hd1 [label="musica",shape=folder]
                books_hd1 [label="libri",shape=folder]
            }

            subgraph cluster_hd2 {
                style=filled;
                color=white;
                label = "2 Tb";

                immagini_hd2 [label="immagini",shape=folder]
                musica_hd2 [label="musica",shape=folder]
                books_hd2 [label="libri",shape=folder]
                sw_hd2 [label="libri",shape=folder]
            }
        }

        subgraph cluster_paranoia {
            style=filled;
            color=yellow;
            label = "server1\nparanoia";

            rsync_paranoia [label="rsync",shape=component]

            filesystem_paranoia [label="filesystem",shape=folder]
            
            subgraph cluster_pubwww_paranoia {
                style=filled;
                color=lightblue;
                label = "Public www";
                
                blog_pubwww [label="blog|site",shape=folder]
                others_pubwww_paranoia [label="others",shape=folder]
            }

            filesystem_paranoia -> rsync_paranoia -> script_rsnapshot
            others_pubwww_paranoia -> rsync_paranoia
        }

        subgraph cluster_sgagliozza {
            style=filled;
            color=cyan;
            label = "server3\nsgagliozza";

            filesystem_sgagliozza [label="filesystem",shape=folder]
            mail_back [label="mail\nbackup",shape=folder,style=filled,fillcolor=green]
            
        }

        subgraph cluster_ovh {
            style=filled;
            color=orange;
            label = "server2\novh";

            rsync_ovh[label="rsync",shape=component]
            filesystem_ovh [label="filesystem",shape=folder]
            
            subgraph cluster_pubwww_ovh {
                style=filled;
                color=lightblue;
                label = "Public www";

                others_pubwww_ovh [label="others",shape=folder]
                owncloud [label="owncloud",shape=component]
                ttrss [label="TT-RSS",shape=component]
                videodb [label="VideoDB",shape=component]
                thinkup [label="ThinkUp",shape=component]
            }

            filesystem_ovh -> rsync_ovh -> script_rsnapshot
            others_pubwww_ovh -> html_back [ltail=cluster_pubwww_ovh]


            // other backups
            subgraph cluster_backup {
                style=filled;
                fillcolor=green;
                label = "backups";

                html_back [label="html\nbackups",shape=folder]
                db_back [label="db\nbackups",shape=folder]
            }
        }

        subgraph cluster_android {
            style=filled;
            color=pink;
            label = "Android";

            sms [label="Android \nSMS",shape=box3d]
            calendar [label="calendar",shape=component]
            contacts [label="contacts",shape=component]
            ff_mobile [label="Firefox\nmobile",shape=component]
            chatmobile [label="Gtalk\nmobile",shape=egg]
            ttrssmobile [label="TT-RSS\nmobile",shape=component]
        }

        pings [label="pings",shape=egg]
        chat [label="Gtalk\ndesktop|web\nlogs",shape=egg]
        
        // ## bindings ##

        // chat
        irssidrop -> irssi [dir=both]
        pings -> riseup
        chat -> gmail
        chatmobile -> gmail

        // android
        firefox -> ffsync -> ff_mobile
        ttrss -> ttrssmobile
        gcalendar -> calendar
        gcontacts -> contacts

        // server backups
        filesystem_edgar -> script_rsnapshot -> rsnapshot -> rsnapshot_edgar_drop [color=forestgreen]

        // service backups
        facebook -> thinkup
        twitter -> thinkup
        foursquare -> thinkup
        ttrss ->  db_back
        videodb -> db_back
        thinkup -> db_back
        owncloud -> html_back
        html_back -> rsync_ovh
        db_back -> rsync_ovh

        // mail - sms
        sms -> gmail
        gmail -> offlineimap [dir=both]
        ai -> offlineimap [dir=both]
        riseup -> offlineimap [dir=both]
        offlineimap -> mail
        mail -> rsync -> mail_back
        
        // internet services
        github -> blog_pubwww [color=forestgreen]
    }

Qui si seguito, invece, i progetti a lungo termine:

    digraph G {
        // TODO
        // * legend
        // * bold cluster labels
        graph [ dpi = 500 ];
        size ="4,6";	// table size
        compound=true;
        ranksep="1.5"
        rankdir="LR"

        subgraph cluster_edgar {
            style=filled;
            color=lightgrey;
            label = "edgar";

            // boxes
            subgraph cluster_drop {
                style=filled;
                color=white;
                label = "Dropbox";

                irssi [label="~/.irssi",shape=folder]
                rsnapshot [label="backup\ndir",shape=folder]
            }

            subgraph cluster_hd1 {
                style=filled;
                color=white;
                label = "320 Gb";

                immagini_hd1 [label="immagini",shape=folder]
                video_hd1 [label="video",shape=folder]
                musica_hd1 [label="musica",shape=folder]
                books_hd1 [label="libri",shape=folder]
            }
            
            // scripts and programs
            offlineimap [label="offlineimap",shape=component]
            script_rsnapshot [label="rsnapshot",shape=component]
            rsync [label="rsync",shape=component]
            sync_owncloud [label="owncloud\nsync",shape=component]
            firefox [label="Firefox",shape=component]
            
            // folders
            mail [label="~/.mail",shape=folder,style=filled,fillcolor="#008000"]
            filesystem_edgar [label="filesystem",shape=folder]
        }

        subgraph cluster_mail {
            style=filled;
            color=lightblue;
            label = "Mail services";

            ai [label="A/I \nmail",shape=box3d,style=filled,fillcolor="#808000"]
            gmail [label="Gmail",shape=box3d]
            riseup [label="Riseup \nmail",shape=box3d,style=filled,fillcolor="#808000"]
        }

        subgraph cluster_services {
            style=filled;
            color=lightblue;
            label = "Internet services";

            github [label="GitHub",shape=component]
            ffsync [label="Firefox\nSync",shape=component]
            librefm [label="Libre.fm",shape=component]
            facebook [label="Facebook",shape=component]
            twitter [label="Twitter",shape=component]
            foursquare [label="Foursquare",shape=component]
            brdcstit [label="brdcst.it",shape=component]
        }

        subgraph cluster_hosting{
            style=filled;
            color=lightblue;
            label = "Hosting services";

            subgraph cluster_droponline{
                style=filled;
                color=blue;
                label = "Dropbox";

                irssidrop [label="~/.irssi",shape=folder,style=filled,fillcolor=green]
                rsnapshot_edgar_drop [label="backup\nedgar\novh\nparanoia\nrpi",shape=folder,style=filled,fillcolor=green]
            }
        }

        subgraph cluster_paranoia {
            style=filled;
            color=yellow;
            label = "server 1\nparanoia";

            rsync_paranoia [label="rsync",shape=component]

            filesystem_paranoia [label="filesystem",shape=folder]
            
            subgraph cluster_pubwww_paranoia {
                style=filled;
                color=lightblue;
                label = "Public www";
                
                blog_pubwww [label="blog|site",shape=folder]
                others_pubwww_paranoia [label="others",shape=folder]
            }

            filesystem_paranoia -> rsync_paranoia -> script_rsnapshot
            others_pubwww_paranoia -> rsync_paranoia
        }

        subgraph cluster_sgagliozza {
            style=filled;
            color=cyan;
            label = "server3\nsgagliozza";

            rsync_sgagliozza [label="rsync",shape=component]

            filesystem_sgagliozza [label="filesystem",shape=folder]

            subgraph cluster_pubwww_sgagliozza {
                style=filled;
                color=lightblue;
                label = "Public www";

                thblog_pubwww [label="th blog",shape=folder]
            }

            filesystem_sgagliozza -> rsync_sgagliozza -> script_rsnapshot
            thblog_pubwww -> rsync_sgagliozza

            mail_back [label="mail\nbackup",shape=folder,style=filled,fillcolor=green]
        }

        subgraph cluster_ovh {
            style=filled;
            color=orange;
            label = "server 2\n ovh";

            rsync_ovh[label="rsync",shape=component]
            filesystem_ovh [label="filesystem",shape=folder]
            
            subgraph cluster_pubwww_ovh {
                style=filled;
                color=lightblue;
                label = "Public www";

                others_pubwww_ovh [label="others",shape=folder]
            }

            filesystem_ovh -> rsync_ovh -> script_rsnapshot
            others_pubwww_ovh -> rsync_ovh [ltail=cluster_pubwww_ovh]
        }

        subgraph cluster_rpi{
            style=filled;
            color=brown;
            label = "RPi";

            sync_owncloud -> owncloud [color=blue]
            lastexport [label="lastexport.py",shape=component]

            rsync_rpi[label="rsync",shape=component]
            filesystem_rpi [label="filesystem",shape=folder]

            subgraph cluster_pubwww_rpi {
                style=filled;
                color=lightblue;
                label = "Public www";

                owncloud [label="owncloud",shape=component]
                ttrss [label="TT-RSS",shape=component]
                videodb [label="VideoDB",shape=component]
                thinkup [label="ThinkUp",shape=component]
            }

            // owncloud backups
            subgraph cluster_owncloud_backup {
                style=filled;
                fillcolor=green;
                label = "synced owncloud \nbackups";

                immagini_back [label="immagini",shape=folder]
                video_back [label="video",shape=folder]
                musica_back [label="musica",shape=folder]
                books_back [label="libri",shape=folder]
            }

            // other backups
            subgraph cluster_backup {
                style=filled;
                fillcolor=green;
                label = "backups";

                data_back [label="data\nbackups",shape=folder]
                db_back [label="db\nbackups",shape=folder]
                html_back [label="html\nbackups",shape=folder]
            }

            filesystem_rpi -> rsync_rpi -> script_rsnapshot
            data_back -> rsync_rpi
            db_back -> rsync_rpi
            html_back -> rsync_rpi
        }

        subgraph cluster_android {
            style=filled;
            color=pink;
            label = "Android";

            sms [label="Android \nSMS",shape=box3d]
            calendar [label="calendar",shape=component]
            contacts [label="contacts",shape=component]
            ff_mobile [label="Firefox\nmobile",shape=component]
            chatmobile [label="Gtalk\nmobile",shape=egg]
            ttrssmobile [label="TT-RSS\nmobile",shape=component]
        }

        pings [label="pings",shape=egg]
        chat [label="Gtalk\ndesktop|web\nlogs",shape=egg]
        
        // ## bindings ##

        // chat
        irssidrop -> irssi [dir=both]
        pings -> riseup
        chat -> gmail
        chatmobile -> gmail

        // android
        owncloud -> calendar [dir=both]
        owncloud -> contacts [dir=both]
        firefox -> ffsync -> ff_mobile
        ttrss -> ttrssmobile

        // server backups
        filesystem_edgar -> script_rsnapshot -> rsnapshot -> rsnapshot_edgar_drop [color=forestgreen]

        // service backups
        github -> data_back
        librefm -> lastexport -> data_back
        facebook -> thinkup
        twitter -> thinkup
        foursquare -> thinkup
        ttrss -> db_back
        videodb -> db_back
        thinkup -> db_back
        owncloud -> html_back

        // mail - sms
        sms -> gmail
        gmail -> offlineimap [dir=both]
        ai -> offlineimap [dir=both]
        riseup -> offlineimap [dir=both]
        offlineimap -> mail
        mail -> rsync -> mail_back
        
        // immagini
        immagini_hd1 -> sync_owncloud
        owncloud -> immagini_back

        // video
        video_hd1 -> sync_owncloud
        owncloud -> video_back

        // musica
        musica_hd1 -> sync_owncloud
        owncloud -> musica_back

        // libri
        books_hd1 -> sync_owncloud
        owncloud -> books_back

        // internet services
        github -> blog_pubwww [color=forestgreen]
    }

   [1]: http://dl.dropbox.com/u/369614/blog/img_red/backup.png
